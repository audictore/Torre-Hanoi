<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torre de Hanói</title>
    <link rel="shortcut icon" href="./assets/vietnam.png" type="image/png">

    <style>
        :root{
            --font-size-lg: 8rem;
            --font-size-md: 3rem;
            --font-size-sm: 1.5rem;
            --font-family-poppins: "Poppins", serif;
            --color-oxford-blue: #0B192F;
            --color-aquamarine: #64FFDA;
            --color-periwinke: #CCD6F6;
            --color-cool-gray: #8892B0;

        }

        body{
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 0;
            margin: 0;
            background-color: var(--color-oxford-blue);

        }

        header{
            width: 100%;
            height: 10%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
            user-select: none;
        }

        header nav{
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header nav ul{
            width: auto;
            height: 100%;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            font-size: var(--font-size-sm);
            font-family: var(--font-family-poppins);
            color: var(--color-aquamarine);
            padding: 0;
            margin: 0;
            list-style: none;
        }

        header nav ul a{
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: var(--font-size-sm);
            font-family: var(--font-family-poppins);
            text-decoration: none;
            color: var(--color-aquamarine);
        }

        header nav ul a img{
            width: 3rem;
            height: 3rem;
        }

        .juego_3_aros, .juego_4_aros, .juego_5_aros, .juego_6_aros, .juego_7_aros{
            width: 100%;
            height: 80%;
            display: none;
            justify-content: space-around;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
        }

        .torre_1, .torre_2, .torre_3_1, .torre_3_2, .torre_3_3, .torre_3_4, .torre_3_5{
            width: 20%;
            height: 70%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-direction: column;
            position: relative;
        }

        .aro_1, .aro_2, .aro_3, .aro_4, .aro_5, .aro_6, .aro_7{
            height: 10%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
            background-color: var(--color-cool-gray);
            font-size: var(--font-size-md);
            color: var(--color-aquamarine);
            font-family: var(--font-family-poppins);
            border: solid 1px;
            border-color: black;
            user-select: none;
        }

        .aro_1{
            width: 30%;
        }
        .aro_2{
            width: 40%;
        }
        .aro_3{
            width: 50%;
        }
        .aro_4{
            width: 60%;
        }
        .aro_5{
            width: 70%;
        }
        .aro_6{
            width: 80%;
        }
        .aro_7{
            width: 90%;
        }

        .poste{
            width: 10%;
            height: 90%;
            position: absolute;

            background-color: var(--color-aquamarine);
        }

        .base{
            width: 100%;
            height: 10%;
            background-color: var(--color-aquamarine);
            color: transparent;
            user-select: none;
        }

        section{
            width: 100%;
            height: 10%;
            display: flex;
            justify-content: space-evenly;
            align-items: center;

        }

        section button{
            width: 20%;
            height: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-oxford-blue);
            color: var(--color-aquamarine);
            font-size: var(--font-size-sm);
            cursor: pointer;
            border: solid 1px var(--color-aquamarine);
            border-radius: 5px;
        }

        section button:hover{
            width: 20%;
            height: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-aquamarine);
            color: var(--color-oxford-blue);
            font-size: var(--font-size-sm);
            border: solid 1px var(--color-aquamarine);
            border-radius: 5px;
        }

        section span{
            width: 25%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: var(--font-size-sm);
            font-family: var(--font-family-poppins);
            color: var(--color-aquamarine);
        }

        .certificado{
            width: 50%;
            height: 60vh;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: fixed;
            background-color: var(--color-oxford-blue);
            color: var(--color-aquamarine);
            font-family: var(--font-family-poppins);
            border: solid 1px var(--color-cool-gray);
            border-radius: 5px;
        }

        .certificado span{
            font-size: var(--font-size-sm);
            color: var(--color-cool-gray);
        }

        .certificado button{
            width: 50%;
            height: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-oxford-blue);
            color: var(--color-aquamarine);
            font-size: var(--font-size-sm);
            cursor: pointer;
            border: solid 1px var(--color-aquamarine);
            border-radius: 5px;
        }

        .certificado button:hover{
            width: 50%;
            height: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--color-aquamarine);
            color: var(--color-oxford-blue);
            font-size: var(--font-size-sm);
            border: solid 1px var(--color-aquamarine);
            border-radius: 5px;
        }
        

    </style>

</head>
<body>

    <header>
        <nav>
            <ul>
                <a href="./index.html"><img src="./assets/vietnam.png">&nbsp;&nbsp;Home</a>
            </ul>
            <ul>
                <span>Nombre usuario: <span class="span_name_user" id="span_name_user"></span></span>
                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cantidad de aros: <span class="span_cantidad_aros_introduccida" id="span_cantidad_aros_introduccida"></span></span>
            </ul>
        </nav>
    </header>

    <main class="juego_3_aros">
        <div class="torre torre_1">
            <div class="aro aro_1" draggable="true">1</div>
            <div class="aro aro_2" draggable="true">2</div>
            <div class="aro aro_3" draggable="true">3</div>
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_3_1">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
    </main>

    <main class="juego_4_aros">
        <div class="torre torre_1">
            <div class="aro aro_1" draggable="true">1</div>
            <div class="aro aro_2" draggable="true">2</div>
            <div class="aro aro_3" draggable="true">3</div>
            <div class="aro aro_4" draggable="true">4</div>
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_3_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
    </main>

    <main class="juego_5_aros">
        <div class="torre torre_1">
            <div class="aro aro_1" draggable="true">1</div>
            <div class="aro aro_2" draggable="true">2</div>
            <div class="aro aro_3" draggable="true">3</div>
            <div class="aro aro_4" draggable="true">4</div>
            <div class="aro aro_5" draggable="true">5</div>
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_3_3">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
    </main>

    <main class="juego_6_aros">
        <div class="torre torre_1">
            <div class="aro aro_1" draggable="true">1</div>
            <div class="aro aro_2" draggable="true">2</div>
            <div class="aro aro_3" draggable="true">3</div>
            <div class="aro aro_4" draggable="true">4</div>
            <div class="aro aro_5" draggable="true">5</div>
            <div class="aro aro_6" draggable="true">6</div>
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_3_4">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
    </main>

    <main class="juego_7_aros">
        <div class="torre torre_1">
            <div class="aro aro_1" draggable="true">1</div>
            <div class="aro aro_2" draggable="true">2</div>
            <div class="aro aro_3" draggable="true">3</div>
            <div class="aro aro_4" draggable="true">4</div>
            <div class="aro aro_5" draggable="true">5</div>
            <div class="aro aro_6" draggable="true">6</div>
            <div class="aro aro_7" draggable="true">7</div>
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_2">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
        <div class="torre torre_3_5">
            <div class="poste"></div>
            <div class="base"></div>
        </div>
    </main>

    <section>
        <button id="button_reiniciar_juego">Reiniciar</button>
        <span>Tiempo: <span id="reloj">00:00:00</span></span>
        <span>Movimientos minimos: <span class="span_movimientos_minimos" id="span_movimientos_minimos"></span></span>
        <span>Movimientos realizados: <span class="span_cantidad_movimientos" id="span_cantidad_movimientos">0</span> </span>
    </section>

    <div class="certificado" id="certificado">
        <h1>¡Felicidades!</h1>
        <h2>Haz completado de Torre de Hanói</h2>
        <span class="span_name_user_certificado" id="span_name_user_certificado"></span>
        <span>Cantidad de aros: <span id="span_cantidad_aros_introduccida_certificado"></span></span>
        <span>Tiempo: <span id="reloj_certificado">00:00:00</span></span>
        <span>Movimientos realizados: <span class="span_cantidad_movimientos_certificado" id="span_cantidad_movimientos_certificado">0</span> </span>
        <br>
        <button id="button_descargar_certificado">Certificado</button>
    </div>
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let name_user = localStorage.getItem("name_user")
        let cantidad_aros_introduccida = parseInt(localStorage.getItem("cantidad_aros_introduccida"))
        let span_name_user = document.getElementById("span_name_user")
        let span_cantidad_aros_introduccida = document.getElementById("span_cantidad_aros_introduccida")

        let juego_3_aros = document.querySelector(".juego_3_aros")
        let estado_original_juego_3_aros = juego_3_aros.innerHTML
        let juego_4_aros = document.querySelector(".juego_4_aros")
        let juego_5_aros = document.querySelector(".juego_5_aros")
        let juego_6_aros = document.querySelector(".juego_6_aros")
        let juego_7_aros = document.querySelector(".juego_7_aros")

        let aros = document.querySelectorAll(".aro")
        let torres = document.querySelectorAll(".torre")
        let torre_1 = document.querySelector(".torre_1")
        let torre_2 = document.querySelector(".torre_2")
        let torre_3_1 = document.querySelector(".torre_3_1")
        let torre_3_2 = document.querySelector(".torre_3_2")
        let torre_3_3 = document.querySelector(".torre_3_3")
        let torre_3_4 = document.querySelector(".torre_3_4")
        let torre_3_5 = document.querySelector(".torre_3_5")
        let aroSeleccionado = null

        let button_reiniciar_juego = document.getElementById("button_reiniciar_juego")
        let span_movimientos_minimos = document.getElementById("span_movimientos_minimos")
        let span_cantidad_movimientos = document.getElementById("span_cantidad_movimientos")
        let contador_movimientos = 0

        let segundos = 0
        let minutos = 0
        let horas = 0

        let certificado = document.getElementById("certificado")
        let span_name_user_certificado = document.getElementById("span_name_user_certificado")
        let span_cantidad_aros_introduccida_certificado = document.getElementById("span_cantidad_aros_introduccida_certificado")
        let reloj_certificado = document.getElementById("reloj_certificado")
        let span_cantidad_movimientos_certificado = document.getElementById("span_cantidad_movimientos_certificado")
        let button_descargar_certificado = document.getElementById("button_descargar_certificado")

        span_name_user.innerHTML = name_user
        span_cantidad_aros_introduccida.innerHTML = cantidad_aros_introduccida

        if(cantidad_aros_introduccida === 3){
            juego_3_aros.style.display = "flex";

        }else if(cantidad_aros_introduccida === 4){
            juego_4_aros.style.display = "flex";

        }else if(cantidad_aros_introduccida === 5){
            juego_5_aros.style.display = "flex";
            
        }else if(cantidad_aros_introduccida === 6){
            juego_6_aros.style.display = "flex";
            
        }else if(cantidad_aros_introduccida === 7){
            juego_7_aros.style.display = "flex";
            
        }

        
        // Función para actualizar qué aros pueden moverse
        function actualizarArosDraggables() {
            torres.forEach(torre => {
                let arosEnTorre = torre.querySelectorAll(".aro");
            
                // Deshabilitar todos los aros
                arosEnTorre.forEach(aro => aro.setAttribute("draggable", false))
            
                // Habilitar solo el primero de cada torre
                if (arosEnTorre.length > 0) {
                    arosEnTorre[0].setAttribute("draggable", true)
                }
            });
        }

        // Asignar eventos a las torres
        torres.forEach(torre => {
            torre.addEventListener("dragstart", function (e) {
                if (e.target.classList.contains("aro") && e.target.getAttribute("draggable") === "true") {
                    aroSeleccionado = e.target // Guardar aro en movimiento
                }
            })
        
            torre.addEventListener("dragover", function (e) {
                e.preventDefault() // Permitir soltar
            });
        
            torre.addEventListener("drop", function (e) {
                e.preventDefault()
                if (!aroSeleccionado) return // Evita errores si no hay aro seleccionado
            
                let primer_aro = this.querySelector(".aro")
            
                // Verificar si se puede colocar el aro
                if (!primer_aro || parseInt(primer_aro.textContent) > parseInt(aroSeleccionado.textContent)) {
                    this.prepend(aroSeleccionado);
                    aroSeleccionado = null // Limpiar variable después de mover
                    actualizarArosDraggables() // Refrescar aros arrastrables
                    
                    if(cantidad_aros_introduccida === 3 && torre_3_1.textContent.replace(/\s+/g, '') === "123"){
                        crear_certificado()

                    }else if(cantidad_aros_introduccida === 4 && torre_3_2.textContent.replace(/\s+/g, '') === "1234"){
                        crear_certificado()

                    }else if(cantidad_aros_introduccida === 5 &&torre_3_3.textContent.replace(/\s+/g, '') === "12345"){
                        crear_certificado()
                        
                    }else if(cantidad_aros_introduccida === 6 && torre_3_4.textContent.replace(/\s+/g, '') === "123456"){
                        crear_certificado()
                        
                    }else if(cantidad_aros_introduccida === 7 && torre_3_5.textContent.replace(/\s+/g, '') === "1234567"){
                        crear_certificado()
                        
                    }
                    
                    contador_movimientos = contador_movimientos + 1
                    span_cantidad_movimientos.innerHTML = contador_movimientos

                }
            })
        })

        // Iniciar el estado correcto de los aros
        actualizarArosDraggables()

        if(cantidad_aros_introduccida === 3){
            span_movimientos_minimos.innerHTML = 7

        }else if(cantidad_aros_introduccida === 4){
            span_movimientos_minimos.innerHTML = 15

        }else if(cantidad_aros_introduccida === 5){
            span_movimientos_minimos.innerHTML = 31

        }else if(cantidad_aros_introduccida === 6){
            span_movimientos_minimos.innerHTML = 63

        }else if(cantidad_aros_introduccida === 7){
            span_movimientos_minimos.innerHTML = 127

        }

        button_reiniciar_juego.addEventListener("click", reiniciar_juego)

        function reiniciar_juego(){
            location.reload()

        }

        function actualizarReloj(){
            segundos++

            if(segundos === 60){
                segundos = 0
                minutos++

                if(minutos === 60){
                    minutos = 0
                    horas++

                    if(horas === 100){
                        horas = 0
                    }
                }

            }

            let formato = 
                String(horas).padStart(2, '0') + ":" + 
                String(minutos).padStart(2, '0') + ":" + 
                String(segundos).padStart(2, '0')

            document.getElementById("reloj").textContent = formato
        }

        setInterval(actualizarReloj, 1000)


        function crear_certificado(){
            span_name_user_certificado.innerHTML = name_user
            span_cantidad_aros_introduccida_certificado.innerHTML = cantidad_aros_introduccida
            reloj_certificado.innerHTML = reloj.textContent
            span_cantidad_movimientos_certificado.innerHTML = contador_movimientos + 1

            certificado.style.display = "flex";
        }

        button_descargar_certificado.addEventListener("click", descargar_pdf)

        function descargar_pdf(){
            var content = document.getElementById('certificado');

            // Usar html2canvas para capturar el contenido del div
            html2canvas(content).then(function(canvas) {
            // Obtener la imagen generada
            var imgData = canvas.toDataURL('image/png');

            // Crear un nuevo documento PDF en formato horizontal
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Indicamos 'landscape' para formato horizontal

            // Ajustar el tamaño del PDF a la página completa
            doc.addImage(imgData, 'PNG', 0, 0, doc.internal.pageSize.width, doc.internal.pageSize.height);

            // Descargar el PDF
            doc.save('documento_torre_hanoi.pdf');
})
        }
    
    </script>
</body>
</html>